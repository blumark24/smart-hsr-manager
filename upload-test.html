<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ù…Ø¹ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firestore</title>
<style>
body {
  font-family: "Tajawal", sans-serif;
  background: #0b2b3a;
  color: white;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100vh;
}
button {
  background: #0ea5a1;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  margin-top: 10px;
}
img {
  margin-top: 15px;
  border-radius: 10px;
  max-width: 200px;
}
input {
  margin: 6px;
  padding: 6px 8px;
  border-radius: 6px;
  border: none;
}
</style>
</head>
<body>
  <h2>ğŸ“¤ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ Firebase + Ø­ÙØ¸ ÙÙŠ Firestore</h2>
  <input type="text" id="userName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
  <input type="file" id="imageUpload" accept="image/*">
  <button id="uploadBtn">Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©</button>
  <img id="preview" style="display:none;">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-storage.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBfClVxFIXgUXL4olEv5SepUDtzk0dq3lo",
  authDomain: "gen-lang-client-0349944917.firebaseapp.com",
  projectId: "gen-lang-client-0349944917",
  storageBucket: "gen-lang-client-0349944917.firebasestorage.app",
  messagingSenderId: "883065484771",
  appId: "1:883065484771:web:c907bb5a51f68caad75cd6"
};

const app = initializeApp(firebaseConfig);
const storage = getStorage(app);
const db = getFirestore(app);

const fileInput = document.getElementById("imageUpload");
const uploadBtn = document.getElementById("uploadBtn");
const preview = document.getElementById("preview");
const userNameInput = document.getElementById("userName");

uploadBtn.addEventListener("click", async () => {
  const file = fileInput.files[0];
  const userName = userNameInput.value.trim();

  if (!userName) return alert("ğŸ§â€â™‚ï¸ Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…");
  if (!file) return alert("ğŸ–¼ï¸ Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹");

  const filePath = `uploads/${Date.now()}_${file.name}`;
  const storageRef = ref(storage, filePath);

  try {
    // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Storage
    await uploadBytes(storageRef, file);
    const url = await getDownloadURL(storageRef);

    // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©
    preview.src = url;
    preview.style.display = "block";

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firestore
    await addDoc(collection(db, "user_uploads"), {
      name: userName,
      imageUrl: url,
      path: filePath,
      createdAt: serverTimestamp()
    });

    alert("âœ… ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© ÙˆØ­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙ‡Ø§ Ø¨Ù†Ø¬Ø§Ø­!");
    console.log("Ø§Ù„Ø±Ø§Ø¨Ø·:", url);

  } catch (err) {
    console.error("Ø®Ø·Ø£:", err);
    alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹ Ø£Ùˆ Ø§Ù„Ø­ÙØ¸.");
  }
});
</script>
</body>
</html>
